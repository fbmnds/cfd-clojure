;; initiallly

;; -2*nu*(-(-8*t + 2*x)*exp(-(-4*t + x)**2/(4*nu*(t + 1)))/(4*nu*(t + 1)) - (-8*t + 2*x - 12.5663706143592)*exp(-(-4*t + x - 6.28318530717959)**2/(4*nu*(t + 1)))/(4*nu*(t + 1)))/(exp(-(-4*t + x - 6.28318530717959)**2/(4*nu*(t + 1))) + exp(-(-4*t + x)**2/(4*nu*(t + 1)))) +
4

;; '-(' to '-1.*('

;; -2*nu*(-1.*(-8*t + 2*x)*exp(-1.*(-4*t + x)**2/(4*nu*(t + 1)))/(4*nu*(t + 1)) - (-8*t + 2*x - 12.5663706143592)*exp(-1.*(-4*t + x - 6.28318530717959)**2/(4*nu*(t + 1)))/(4*nu*(t + 1)))/(exp(-1.*(-4*t + x - 6.28318530717959)**2/(4*nu*(t + 1))) + exp(-1.*(-4*t + x)**2/(4*nu*(t + 1)))) +
4

;; '(t + 1)' to '(inc t)'

;; -2*nu*(-1.*(-8*t + 2*x)*exp(-1.*(-4*t + x)**2/(4*nu*(inc t)))/(4*nu*(inc t)) - (-8*t + 2*x - 12.5663706143592)*exp(-1.*(-4*t + x - 6.28318530717959)**2/(4*nu*(inc t)))/(4*nu*(inc t)))/(exp(-1.*(-4*t + x - 6.28318530717959)**2/(4*nu*(inc t))) + exp(-1.*(-4*t + x)**2/(4*nu*(inc t)))) +
4

;; '(-4*t + x)' to '(+ (* -4. t) x)'

;; -2*nu*(-1.*(-8*t + 2*x)*exp(-1.*(+ (* -4. t) x)**2/(4*nu*(inc t)))/(4*nu*(inc t)) - (-8*t + 2*x - 12.5663706143592)*exp(-1.*(-4*t + x - 6.28318530717959)**2/(4*nu*(inc t)))/(4*nu*(inc t)))/(exp(-1.*(-4*t + x - 6.28318530717959)**2/(4*nu*(inc t))) + exp(-1.*(+ (* -4. t) x)**2/(4*nu*(inc t)))) +
4

;; '(-8*t + 2*x - 12.5663706143592)' to '(* 2. (-4*t + x - 6.28318530717959))'

;; -2*nu*(-1.*(-8*t + 2*x)*exp(-1.*(+ (* -4. t) x)**2/(4*nu*(inc t)))/(4*nu*(inc t)) - (* 2. (-4*t + x - 6.28318530717959))*exp(-1.*(-4*t + x - 6.28318530717959)**2/(4*nu*(inc t)))/(4*nu*(inc t)))/(exp(-1.*(-4*t + x - 6.28318530717959)**2/(4*nu*(inc t))) + exp(-1.*(+ (* -4. t) x)**2/(4*nu*(inc t)))) +
4

;; '(-4*t + x - 6.28318530717959)' to '(+ (* -4 t) x -6.28318530717959)'

;; -2*nu*(-1.*(-8*t + 2*x)*exp(-1.*(+ (* -4. t) x)**2/(4*nu*(inc t)))/(4*nu*(inc t)) - (* 2. (+ (* -4 t) x -6.28318530717959))*exp(-1.*(+ (* -4 t) x -6.28318530717959)**2/(4*nu*(inc t)))/(4*nu*(inc t)))/(exp(-1.*(+ (* -4 t) x -6.28318530717959)**2/(4*nu*(inc t))) + exp(-1.*(+ (* -4. t) x)**2/(4*nu*(inc t)))) + 4

;; '(4*nu*(inc t))' to '(* 4. nu (inc t))'

;; -2*nu*(-1.*(-8*t + 2*x)*exp(-1.*(+ (* -4. t) x)**2/(* 4. nu (inc t)))/(* 4. nu (inc t)) - (* 2. (+ (* -4 t) x -6.28318530717959))*exp(-1.*(+ (* -4 t) x -6.28318530717959)**2/(* 4. nu (inc t)))/(* 4. nu (inc t)))/(exp(-1.*(+ (* -4 t) x -6.28318530717959)**2/(* 4. nu (inc t))) + exp(-1.*(+ (* -4. t) x)**2/(* 4. nu (inc t)))) + 4

;; '(+ (* -4. t) x)**2' to '(math/expr (+ (* -4. t) x) 2.)'

;; -2*nu*(-1.*(-8*t + 2*x)*exp(-1.*(math/expr (+ (* -4. t) x) 2.)/(* 4. nu (inc t)))/(* 4. nu (inc t)) - (* 2. (+ (* -4 t) x -6.28318530717959))*exp(-1.*(+ (* -4 t) x -6.28318530717959)**2/(* 4. nu (inc t)))/(* 4. nu (inc t)))/(exp(-1.*(+ (* -4 t) x -6.28318530717959)**2/(* 4. nu (inc t))) + exp(-1.*(math/expr (+ (* -4. t) x) 2.)/(* 4. nu (inc t)))) + 4

;; '(+ (* -4 t) x -6.28318530717959)**2' '(math/expr (+ (* -4 t) x -6.28318530717959) 2.)'

;; -2*nu*(-1.*(-8*t + 2*x)*exp(-1.*(math/expr (+ (* -4. t) x) 2.)/(* 4. nu (inc t)))/(* 4. nu (inc t)) - (* 2. (+ (* -4 t) x -6.28318530717959))*exp(-1.*(math/expr (+ (* -4 t) x -6.28318530717959) 2.)/(* 4. nu (inc t)))/(* 4. nu (inc t)))/(exp(-1.*(math/expr (+ (* -4 t) x -6.28318530717959) 2.)/(* 4. nu (inc t))) + exp(-1.*(math/expr (+ (* -4. t) x) 2.)/(* 4. nu (inc t)))) + 4

;; '(-8*t + 2*x)' to '(+ (* -8. t) (* 2. x))'

;; -2*nu*(-1.*(+ (* -8. t) (* 2. x))*exp(-1.*(math/expr (+ (* -4. t) x) 2.)/(* 4. nu (inc t)))/(* 4. nu (inc t)) - (* 2. (+ (* -4 t) x -6.28318530717959))*exp(-1.*(math/expr (+ (* -4 t) x -6.28318530717959) 2.)/(* 4. nu (inc t)))/(* 4. nu (inc t)))/(exp(-1.*(math/expr (+ (* -4 t) x -6.28318530717959) 2.)/(* 4. nu (inc t))) + exp(-1.*(math/expr (+ (* -4. t) x) 2.)/(* 4. nu (inc t)))) + 4


;; extract 'exp(-1.*(math/expr (+ (* -4. t) x) 2.)/(* 4. nu (inc t)))'
(comment
(let [f1 exp(-1.*(math/expr (+ (* -4. t) x) 2.)/(* 4. nu (inc t)))]
-2*nu*(-1.*(+ (* -8. t) (* 2. x))*f1/(* 4. nu (inc t)) - (* 2. (+ (* -4 t) x -6.28318530717959))*exp(-1.*(math/expr (+ (* -4 t) x -6.28318530717959) 2.)/(* 4. nu (inc t)))/(* 4. nu (inc t)))/(exp(-1.*(math/expr (+ (* -4 t) x -6.28318530717959) 2.)/(* 4. nu (inc t))) + f1) + 4
))


;; extract '(* 4. nu (inc t))'
(comment
(let [f1 exp(-1.*(math/expr (+ (* -4. t) x) 2.)/(* 4. nu (inc t)))
      f2 (* 4. nu (inc t))]
-2*nu*(-1.*(+ (* -8. t) (* 2. x))*f1/f2 - (* 2. (+ (* -4 t) x -6.28318530717959))*exp(-1.*(math/expr (+ (* -4 t) x -6.28318530717959) 2.)/f2)/f2)/(exp(-1.*(math/expr (+ (* -4 t) x -6.28318530717959) 2.)/f2) + f1) + 4
))


;; extract '(math/expr (+ (* -4 t) x -6.28318530717959) 2.)/f2)'
(comment
(let [f1 exp(-1.*(math/expr (+ (* -4. t) x) 2.)/(* 4. nu (inc t)))
      f2 (* 4. nu (inc t))
      f3 (math/expr (+ (* -4 t) x -6.28318530717959) 2.)]
-2*nu*(-1.*(+ (* -8. t) (* 2. x))*f1/f2 - (* 2. (+ (* -4 t) x -6.28318530717959))*exp(-1.*f3/f2)/f2)/(exp(-1.*f3/f2) + f1) + 4
))



;; extract '(* 2. (+ (* -4 t) x -6.28318530717959))'
(comment
(let [f1 exp(-1.*(math/expr (+ (* -4. t) x) 2.)/(* 4. nu (inc t)))
      f2 (* 4. nu (inc t))
      f3 (math/expr (+ (* -4 t) x -6.28318530717959) 2.)
      f4 (* 2. (+ (* -4 t) x -6.28318530717959))]
-2*nu*(-1.*(+ (* -8. t) (* 2. x))*f1/f2 - f4*exp(-1.*f3/f2)/f2)/(exp(-1.*f3/f2) + f1) + 4
))


;; extract 'exp(-1.*f3/f2)'
(comment
(let [f1 exp(-1.*(math/expr (+ (* -4. t) x) 2.)/(* 4. nu (inc t)))
      f2 (* 4. nu (inc t))
      f3 (math/expr (+ (* -4 t) x -6.28318530717959) 2.)
      f4 (* 2. (+ (* -4 t) x -6.28318530717959))
      f5 exp(-1.*f3/f2)]
-2*nu*(-1.*(+ (* -8. t) (* 2. x))*f1/f2 - f4*f5/f2)/(f5 + f1) + 4
))


;; extract '-1.*(+ (* -8. t) (* 2. x))'
(comment
(let [f1 exp(-1.*(math/expr (+ (* -4. t) x) 2.)/(* 4. nu (inc t)))
      f2 (* 4. nu (inc t))
      f3 (math/expr (+ (* -4 t) x -6.28318530717959) 2.)
      f4 (* 2. (+ (* -4 t) x -6.28318530717959))
      f5 exp(-1.*f3/f2)
      f6 -1.*(+ (* -8. t) (* 2. x))]
-2*nu*(f6*f1/f2 - f4*f5/f2)/(f5 + f1) + 4
))

;; reorder +, -, *, /, exp

(let [f1 (exp -1.*(math/expr (+ (* -4. t) x) 2.)/(* 4. nu (inc t)))
      f2 (* 4. nu (inc t))
      f3 (math/expr (+ (* -4 t) x -6.28318530717959) 2.)
      f4 (* 2. (+ (* -4 t) x -6.28318530717959))
      f5 (exp -1.*f3/f2)
      f6 -1.*(+ (* -8. t) (* 2. x))]
(+ (/ (* -2. nu (- f6*f1/f2 f4*f5/f2) (+ f5 f1)) 4.)))
